<header class="site-header tone-tokens" role="banner">
  <shared-container class="header-grid">
    <!-- Hamburger Menu (Mobile + Desktop Navigation) - Only shown if logged in -->
    <shared-hamburger-menu *ngIf="tokens?.access" class="hamburger"></shared-hamburger-menu>

    <div class="logo">
      <a class="brand" [routerLink]="['/', langCode(), '']">{{ 'common.brand' | t }}</a>
    </div>

    <div class="lang-wrap">
      <button
        class="lang-chip"
        type="button"
        [attr.aria-label]="'common.lang_change' | t"
        (click)="openLang()">
        <span class="globe" aria-hidden="true">ğŸŒ</span>
        <span class="lang-text">{{ langLabelKey() | t }}</span>
      </button>
    </div>

    <div class="auth">
      <!-- Non connectÃ© : Connexion + Inscription -->
      <ng-container *ngIf="!tokens?.access">
        <shared-button
          class="btn-auth"
          variant="outline"
          size="sm"
          [routerLink]="['/', langCode(), 'auth', 'login']">
          {{ 'auth.login' | t }}
        </shared-button>
        <shared-button
          class="btn-auth"
          variant="accent"
          size="sm"
          [routerLink]="['/', langCode(), 'auth', 'register']">
          {{ 'auth.register' | t }}
        </shared-button>
      </ng-container>

      <!-- ConnectÃ© : Nom + Avatar + DÃ©connexion -->
      <ng-container *ngIf="tokens?.access && (me$ | async) as me">
        <shared-button
          *ngIf="me?.is_staff"
          class="btn-auth"
          variant="outline"
          size="sm"
          [routerLink]="['/', langCode(), 'admin', 'audit']">
          Admin Logs
        </shared-button>
        <button
          class="user-profile"
          type="button"
          aria-label="Profil utilisateur"
          [routerLink]="['/', langCode(), 'profile']">
          <span class="user-avatar" aria-hidden="true">ğŸ‘¤</span>
          <span class="user-name">{{ me.first_name }}</span>
        </button>
        <shared-button
          class="btn-auth"
          variant="outline"
          size="sm"
          type="button"
          (click)="onLogout()"
          [disabled]="loading">
          {{ loading ? ('common.loading' | t) : ('auth.logout' | t) }}
        </shared-button>
      </ng-container>
    </div>
  </shared-container>
</header>

<app-language-popover
  *ngIf="showLang()"
  [langs]="langs"
  [current]="currentLang()"
  (save)="confirmLang($event)"
  (close)="closeLang()">
</app-language-popover>

