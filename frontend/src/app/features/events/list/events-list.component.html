<shared-container>
  <!-- Header avec titre et indicateur de tri intelligent -->
  <div class="events-header">
    <div class="header-content">
      <h1 class="events-title">{{ 'events.title' | t }}</h1>
      <p class="events-subtitle" *ngIf="userCity">
        {{ 'events.near_city' | t:{ city: userCity } }}
      </p>
    </div>

    <!-- Indicateur de tri intelligent -->
    <div class="smart-sort-indicator" *ngIf="isSmartSortActive()">
      <shared-badge variant="primary" tone="soft" class="smart-badge">
        <span class="badge-icon">âœ¨</span>
        {{ 'events.sort_info.title' | t }}
      </shared-badge>
    </div>
  </div>

  <!-- Barre de recherche et filtres -->
  <div class="search-section">
    <shared-search-bar
      [fields]="[
        { type: 'multiselect', placeholder: ('shared.search.select_placeholder' | t), options: langOptions(), width: '200px' },
        { type: 'text',        placeholder: ('shared.search.placeholder_event' | t), width: '1fr' }
      ]"
      [searchButtonText]="'shared.search.submit' | t"
      (search)="onSearchBar($event)">
    </shared-search-bar>
  </div>

  <!-- Message d'erreur -->
  <div class="state-error" *ngIf="error() as err">
    <shared-badge variant="danger" tone="soft">{{ err | t }}</shared-badge>
  </div>

  <!-- Ã‰tat vide -->
  <div class="state-empty" *ngIf="filteredEvents().length === 0 && !error()">
    <div class="empty-illustration">ğŸ”</div>
    <h3 class="empty-title">{{ 'events.empty' | t }}</h3>
    <p class="empty-subtitle">Essayez d'ajuster vos filtres ou revenez plus tard</p>
    <shared-button variant="outline" (click)="resetSearch()" *ngIf="searchInput || selectedLangCodes.length > 0">
      {{ 'events.filters.reset' | t }}
    </shared-button>
  </div>

  <!-- Grille d'Ã©vÃ©nements -->
  <div class="events-grid" *ngIf="filteredEvents().length > 0">
    <app-event-card
      *ngFor="let scoredEvent of filteredEvents(); trackBy: trackById"
      [event]="scoredEvent.event"
      [isNearby]="scoredEvent.isNearby"
      [isRecommended]="scoredEvent.isRecommended"
      (book)="onBookEvent($event)"
      (viewDetails)="onViewDetails($event)">
    </app-event-card>
  </div>

  <!-- Compteur de rÃ©sultats -->
  <div class="results-count" *ngIf="filteredEvents().length > 0">
    <p class="count-text">
      {{ filteredEvents().length }} Ã©vÃ©nement{{ filteredEvents().length > 1 ? 's' : '' }} trouvÃ©{{ filteredEvents().length > 1 ? 's' : '' }}
    </p>
  </div>
</shared-container>

<!-- Modal de confirmation d'achat -->
<app-confirm-purchase
  *ngIf="confirmPopup"
  [titleKey]="'checkout.title'"
  [messageKey]="'checkout.message'"
  [buyKey]="'checkout.buy'"
  [cancelKey]="'common.cancel'"
  [priceCents]="getSelectedEventPrice()"
  [asModal]="true"
  (cancel)="closeDialog()"
  (buy)="performPurchase()">
</app-confirm-purchase>
