<shared-container>
  <shared-headline-bar
    [title]="'events.title' | t"
    [subtitle]="userCity ? ('events.near_city' | t:{ city: userCity }) : ''"
    [actionLabel]="'events.add_event' | t"
    (action)="onCreateEvent()">
  </shared-headline-bar>

  <!-- Barre de recherche et filtres -->
  <div class="search-section">
    <shared-search-bar
      [fields]="[
        { type: 'multiselect', placeholder: ('shared.search.select_placeholder' | t), options: langOptions(), width: '200px' },
        { type: 'text',        placeholder: ('shared.search.placeholder_event' | t), width: '1fr' }
      ]"
      [searchButtonText]="'shared.search.submit' | t"
      (search)="onSearchBar($event)">
    </shared-search-bar>
  </div>

  <!-- Message d'erreur -->
  <div class="state-error" *ngIf="error() as err">
    <shared-badge variant="danger" tone="soft">{{ err | t }}</shared-badge>
  </div>

  <!-- Ã‰tat vide -->
  <shared-empty-state
    *ngIf="myEvents().length === 0 && publicEvents().length === 0 && !error()"
    [icon]="'ğŸ”'"
    [title]="'events.empty' | t"
    [subtitle]="'Essayez d\'ajuster vos filtres ou revenez plus tard'"
    [actionLabel]="(searchInput || selectedLangCodes.length > 0) ? ('events.filters.reset' | t) : null"
    (action)="resetSearch()">
  </shared-empty-state>

  <!-- Section "Mes Ã©vÃ©nements" -->
  <section class="my-events-section" *ngIf="myEvents().length > 0">
    <h2 class="section-title">{{ 'events.my_events' | t }}</h2>
    <div class="events-grid">
      <app-event-card
        *ngFor="let scoredEvent of myEvents(); trackBy: trackById"
        [event]="scoredEvent.event"
        [isNearby]="scoredEvent.isNearby"
        [isRecommended]="scoredEvent.isRecommended"
        (book)="onBookEvent($event)"
        (viewDetails)="onViewDetails($event)"
        (payDraft)="onPayDraft($event)">
      </app-event-card>
    </div>
  </section>

  <!-- Section "Tous les Ã©vÃ©nements" -->
  <section class="public-events-section" *ngIf="publicEvents().length > 0">
    <h2 class="section-title">{{ 'events.all_events' | t }}</h2>
    <div class="events-grid">
      <app-event-card
        *ngFor="let scoredEvent of publicEvents(); trackBy: trackById"
        [event]="scoredEvent.event"
        [isNearby]="scoredEvent.isNearby"
        [isRecommended]="scoredEvent.isRecommended"
        (book)="onBookEvent($event)"
        (viewDetails)="onViewDetails($event)">
      </app-event-card>
    </div>
  </section>

  <!-- Compteur de rÃ©sultats -->
  <div class="results-count" *ngIf="myEvents().length > 0 || publicEvents().length > 0">
    <p class="count-text">
      {{ myEvents().length + publicEvents().length }} Ã©vÃ©nement{{ (myEvents().length + publicEvents().length) > 1 ? 's' : '' }} trouvÃ©{{ (myEvents().length + publicEvents().length) > 1 ? 's' : '' }}
    </p>
  </div>
</shared-container>

<!-- Modal de confirmation d'achat -->
<app-confirm-purchase
  *ngIf="confirmPopup"
  [titleKey]="'checkout.title'"
  [messageKey]="'checkout.message'"
  [buyKey]="'checkout.buy'"
  [cancelKey]="'common.cancel'"
  [priceCents]="getSelectedEventPrice()"
  [asModal]="true"
  (cancel)="closeDialog()"
  (buy)="performPurchase()">
</app-confirm-purchase>
